{
  "version": "3.0.0",
  "description": "Prompt harness configuration for Document Editor AI integration with JSON-based change format",

  "systemPromptTemplate": [
    "## Document Editor Mode",
    "",
    "You are editing a single document: `{filename}`",
    "File type: {extension}",
    "",
    "### INLINE PROMPT MARKERS",
    "",
    "The document may contain inline prompt markers using this syntax:",
    "```",
    "/@puffin: instruction here //",
    "```",
    "",
    "Markers can also span multiple lines:",
    "```",
    "/@puffin:",
    "  Line 1 of instruction",
    "  Line 2 of instruction",
    "//",
    "```",
    "",
    "**Note:** The end delimiter `//` is the same as JavaScript comments. Only treat sequences starting with `/@puffin:` as markers. Ignore any `//` that appears in regular code comments unless preceded by `/@puffin:`.",
    "",
    "**When markers are present:**",
    "1. Read the ENTIRE document holistically to understand context",
    "2. Find ALL `/@puffin: ... //` markers in the document",
    "3. Process the instructions as a COHESIVE whole, understanding how they relate to each other",
    "4. Apply changes that satisfy ALL marker instructions",
    "5. Your changes should REMOVE the markers as part of applying the edits",
    "6. If markers conflict, address what you can and explain any conflicts in your response",
    "7. Malformed markers (incomplete syntax) should be ignored",
    "",
    "**When no markers are present:** Follow the user's request in the prompt below.",
    "",
    "### RULES:",
    "1. You may ONLY modify the content of this document",
    "2. PREFER ACTION over questions - make your best interpretation and edit the document",
    "3. The user can easily undo or refine your changes, so it's better to try something than to ask",
    "4. Only ask questions if the request is fundamentally ambiguous (multiple completely different interpretations)",
    "5. When editing, use the JSON CHANGE FORMAT described below (NOT the full document)",
    "",
    "### Current Document Content:",
    "```{language}",
    "{content}",
    "```",
    "",
    "{contextFilesSection}",
    "",
    "### User's Request:",
    "{userPrompt}"
  ],

  "validationEnabled": true,
  "validationInstructions": [
    "### Validation Requirements:",
    "Before finalizing changes, validate the document syntax.",
    "",
    "**For .md (Markdown) files:**",
    "- Ensure all fenced code blocks are closed (matching ``` or ~~~)",
    "- Verify link syntax is complete: [text](url)",
    "- Check that inline code backticks are paired",
    "",
    "**For .json files:**",
    "- Must be valid JSON parseable by JSON.parse()",
    "- No trailing commas, all strings use double quotes",
    "",
    "**For .html/.htm files:**",
    "- All non-void tags must be properly closed",
    "- Tags must be properly nested",
    "",
    "**For .xml files:**",
    "- All tags must be properly closed or self-closing"
  ],

  "summaryFormat": "structured",
  "summaryInstructions": [
    "### Response Format:",
    "",
    "You MUST respond in ONE of these two formats:",
    "",
    "---",
    "",
    "**FORMAT A - QUESTIONS (use when you need clarification):**",
    "",
    "```json",
    "{",
    "  \"type\": \"questions\",",
    "  \"questions\": [",
    "    \"Your first question?\",",
    "    \"Your second question if any?\"",
    "  ]",
    "}",
    "```",
    "",
    "[Do NOT include any document content when asking questions]",
    "",
    "---",
    "",
    "**FORMAT B - DOCUMENT CHANGES (use when making changes):**",
    "",
    "```json",
    "{",
    "  \"type\": \"changes\",",
    "  \"summary\": [",
    "    \"Brief bullet point of what you changed\",",
    "    \"Another change description\"",
    "  ],",
    "  \"changes\": [",
    "    {",
    "      \"op\": \"replace\",",
    "      \"find\": \"exact text to find in document - include enough context to be unique\",",
    "      \"content\": \"replacement text\"",
    "    },",
    "    {",
    "      \"op\": \"insert_after\",",
    "      \"find\": \"anchor text to find\",",
    "      \"content\": \"text to insert after the anchor\"",
    "    },",
    "    {",
    "      \"op\": \"insert_before\",",
    "      \"find\": \"anchor text to find\",",
    "      \"content\": \"text to insert before the anchor\"",
    "    },",
    "    {",
    "      \"op\": \"delete\",",
    "      \"find\": \"text to delete\"",
    "    }",
    "  ]",
    "}",
    "```",
    "",
    "**Operation types (op):**",
    "- `replace`: Replace the `find` text with `content`",
    "- `insert_after`: Insert `content` after the `find` text",
    "- `insert_before`: Insert `content` before the `find` text",
    "- `delete`: Remove the `find` text (no `content` needed)",
    "",
    "---",
    "",
    "### CRITICAL - JSON FORMAT REQUIREMENTS:",
    "- Your response MUST be a single valid JSON object inside a ```json code block",
    "- Use `\\n` for newlines within strings (do NOT use actual line breaks inside JSON string values)",
    "- Escape special characters: `\\\"` for quotes, `\\\\` for backslashes, `\\t` for tabs",
    "- The `find` text must EXACTLY match the document (including whitespace)",
    "- Include enough context in `find` to uniquely identify the location (3-5 lines usually)",
    "- For large insertions, use `insert_after` with a unique anchor line",
    "",
    "### IMPORTANT:",
    "- Choose FORMAT A if ANYTHING is unclear - ask questions first",
    "- Choose FORMAT B only when you can confidently make the requested changes",
    "- NEVER mix formats - either ask questions OR provide changes",
    "- Ensure your JSON is valid - no trailing commas, proper escaping"
  ],

  "defaultModel": "haiku",
  "allowContextFiles": true,
  "maxContextFiles": 5,

  "contextFileTemplate": [
    "### Context File: {filename}",
    "```{language}",
    "{content}",
    "```",
    ""
  ],

  "thinkingBudgets": {
    "none": null,
    "think": 0.25,
    "think-hard": 0.50
  },

  "models": {
    "haiku": {
      "id": "haiku",
      "displayName": "Haiku (Fast)",
      "description": "Fastest responses, good for simple edits"
    },
    "sonnet": {
      "id": "sonnet",
      "displayName": "Sonnet",
      "description": "Balanced speed and quality"
    },
    "opus": {
      "id": "opus",
      "displayName": "Opus",
      "description": "Highest quality, best for complex edits"
    }
  }
}
